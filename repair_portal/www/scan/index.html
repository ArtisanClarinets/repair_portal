{% extends "templates/web.html" %}

{% block title %}Scan Repair Tag{% endblock %}

{% block page_content %}
<div class="scan-container">
  <h1 class="mb-4">{{ _('Scan Repair Tag') }}</h1>
  <div class="scan-grid">
    <div class="video-wrapper">
      <video id="repair-scan-video" autoplay playsinline muted></video>
      <div id="scan-overlay">{{ _('Point the camera at a QR or barcode') }}</div>
    </div>
    <div class="actions">
      <button class="btn btn-primary" id="start-scan">{{ _('Start Camera Scan') }}</button>
      <div class="mt-3">
        <label for="manual-code" class="form-label">{{ _('Enter code manually') }}</label>
        <div class="input-group">
          <input type="text" class="form-control" id="manual-code" placeholder="{{ _('e.g. REP-ORD-2025-00001') }}">
          <button class="btn btn-secondary" id="manual-submit">{{ _('Go') }}</button>
        </div>
      </div>
      <div id="scan-status" class="text-muted small mt-3"></div>
    </div>
  </div>
</div>
<script src="/assets/repair_portal/js/qr_scanner.js"></script>
<script>
  window.repairPortalScan.init({
    video: document.getElementById('repair-scan-video'),
    overlay: document.getElementById('scan-overlay'),
    status: document.getElementById('scan-status'),
    manualInput: document.getElementById('manual-code'),
    manualButton: document.getElementById('manual-submit'),
    startButton: document.getElementById('start-scan'),
    resolver: '{{ frappe.utils.get_url("/api/method/repair_portal.www.scan.index.resolve_code") }}'
  });
</script>
<style>
.scan-container { max-width: 760px; margin: 0 auto; }
.scan-grid { display: grid; grid-template-columns: minmax(0, 1fr); gap: 1.5rem; }
.video-wrapper { position: relative; background: #111; border-radius: 12px; overflow: hidden; min-height: 260px; }
.video-wrapper video { width: 100%; height: 100%; object-fit: cover; }
#scan-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #fff; background: rgba(0,0,0,0.35); font-weight: 600; text-align: center; padding: 1rem; transition: opacity .2s ease; }
@media (min-width: 768px) { .scan-grid { grid-template-columns: 2fr 1fr; } }
</style>
{% endblock %}
